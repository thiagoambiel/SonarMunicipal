% ======================================================================
% Relatorio Cientifico (SBC-style) — Sonar Municipal / Sonar Digital
% Arquivo unico e auto-contido (inclui .bib via filecontents)
% Compilacao sugerida: pdflatex -> biber -> pdflatex -> pdflatex
% ======================================================================

\documentclass[10pt,a4paper]{article}

% -------------------------
% Pacotes
% -------------------------
\usepackage[a4paper,margin=2.2cm]{geometry}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[brazil,english]{babel}
\usepackage{times}
\usepackage{microtype}
\usepackage[hidelinks]{hyperref}
\usepackage{url}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{amsmath,amssymb}
\usepackage{enumitem}
\usepackage{caption}
\usepackage{float}
\usepackage{multirow}
\usepackage{siunitx}

% Biblatex ABNT
\usepackage{csquotes}
\usepackage[backend=biber,style=numeric,language=brazil,sorting=none]{biblatex}
\addbibresource{sonar-references.bib}

% TikZ (corrigido: positioning)
\usepackage{tikz}
\usetikzlibrary{positioning,arrows.meta,calc,shapes}

% Algoritmos (corrigido: ambiente algorithmic)
\usepackage{algorithm}
\usepackage{algpseudocode}
\algrenewcommand\algorithmicrequire{Entrada:}
\algrenewcommand\algorithmicensure{Saída:}

% -------------------------
% Ajustes de estilo
% -------------------------
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt}
\captionsetup{font=small,labelfont=bf}

\newenvironment{resumo}{
  \selectlanguage{brazil}
  \begin{center}Resumo\end{center}
  \small
}{
  \normalsize
  \selectlanguage{brazil}
}
\newcommand{\keywords}[1]{\vspace{2pt}\noindent Keywords: #1}
\newcommand{\palavrasChave}[1]{\vspace{2pt}\noindent Palavras-chave: #1}

% -------------------------
% Metadados editáveis
% -------------------------
\title{Sonar Municipal: Recomendação de Políticas Públicas a partir de Projetos de Lei Municipais e Indicadores Oficiais}

\author{
  \begin{minipage}[t]{0.48\textwidth}
  \centering
  Thiago Ambiel \\
  University of São Paulo - USP \\
  São Carlos-SP, Brazil \\
  \texttt{thiago.ambiel@usp.br}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\textwidth}
  \centering
  André C. P. L. F. de Carvalho \\
  University of São Paulo - USP \\
  São Carlos-SP, Brazil \\
  \texttt{andre@icmc.usp.br}
  \end{minipage}
}

\date{}

% ======================================================================
\begin{document}
\selectlanguage{brazil}

\twocolumn[
\maketitle

\selectlanguage{english}
\begin{abstract}
Municipal governments often need to draft, compare, and justify legislative proposals under limited time and resources. This report describes a reproducible method to discover Brazilian SAPL instances, extract municipal Bills (Projetos de Lei), transform their short summaries (ementas) into action-oriented recommendations, and retrieve relevant actions via semantic search. We also describe how time-series indicators from official sources can be used to approximate real-world effects, and how similar proposals can be grouped into policy clusters to improve statistical robustness. Finally, we present a web platform that operationalizes the method for non-technical users.
\keywords{municipal legislation; SAPL; semantic search; text-to-text models; open data; reproducibility}
\end{abstract}

\selectlanguage{brazil}
\begin{resumo}
Gestores municipais frequentemente precisam redigir, comparar e justificar proposições legislativas com restrição de tempo e de recursos. Este relatório descreve um método reprodutível para (i) descobrir instâncias do SAPL no Brasil, (ii) extrair Projetos de Lei (PLs), (iii) transformar ementas em recomendações de ação, e (iv) recuperar ações relevantes por busca semântica. Também descrevemos como indicadores em séries temporais de fontes oficiais podem ser usados para estimar efeitos no mundo real, e como agrupar projetos similares em ``políticas públicas'' aumenta o poder estatístico e a explicabilidade. Por fim, apresentamos uma plataforma web que torna o método acessível a usuários sem perfil técnico.
\palavrasChave{legislação municipal; SAPL; busca semântica; modelos texto-para-texto; dados abertos; reprodutibilidade}
\end{resumo}
\vspace{12pt}
]

% ======================================================================
\section{Introdução}

A produção legislativa municipal no Brasil ocorre em um cenário de alta diversidade institucional. Mesmo quando municípios enfrentam problemas semelhantes (por exemplo, segurança pública ou evasão escolar), as soluções propostas variam em linguagem, escopo e grau de detalhamento. Essa heterogeneidade dificulta comparar, reutilizar e avaliar propostas existentes, reduzindo a eficiência da tomada de decisão baseada em evidências.

Este trabalho descreve o projeto Sonar Municipal (plataforma web: \url{https://sonar-municipal.vercel.app/}), cujo objetivo é apoiar a elaboração e a análise de Projetos de Lei (PLs) por meio de:
\begin{itemize}[leftmargin=*,nosep]
  \item descoberta e coleta sistemática de PLs em instâncias do SAPL;
  \item transformação de ementas em recomendações de ação;
  \item busca semântica de ações a partir de perguntas do usuário;
  \item simulação aproximada de efeitos em indicadores oficiais ao longo do tempo;
  \item agrupamento de PLs similares em ``políticas públicas'' para análise conjunta.
\end{itemize}

Contribuições. As principais contribuições são: (C1) método auditável para descoberta de instâncias do SAPL e extração exaustiva de PLs via API; (C2) transformação de ementas em recomendações de ação; (C3) busca semântica baseada em embeddings; (C4) análise de indicadores com agrupamento de projetos similares; (C5) plataforma web para usuários não técnicos.

% ======================================================================
\section{Fundamentação e conceitos utilizados}

\subsection{SAPL e padronização do processo legislativo}

O SAPL (Sistema de Apoio ao Processo Legislativo) é mantido pelo Programa Interlegis e amplamente adotado por casas legislativas brasileiras para informatizar e dar publicidade ao processo legislativo \cite{interlegis_sapl}. O sistema organiza etapas como proposição, tramitação e votação, favorecendo padronização. Por ser de código aberto \cite{interlegis_sapl_repo}, muitas instâncias compartilham estruturas de dados e padrões de consulta e, em vários casos, expõem uma API.

\subsection{APIs HTTP, REST, OpenAPI e Swagger}

Uma API (Interface de Programação de Aplicações) é um conjunto de regras que permite que programas acessem funcionalidades e dados de um serviço. Neste trabalho, consideramos APIs acessadas via HTTP/HTTPS.

O estilo REST (Representational State Transfer) organiza a API em recursos acessados por URLs, com operações padronizadas (por exemplo, GET para consulta) \cite{fielding_rest_2000}. Um endpoint é a URL associada a um recurso específico (por exemplo, uma lista de matérias).

OpenAPI descreve formalmente endpoints, parâmetros e respostas em um formato legível por máquina \cite{openapi_3_2}. O Swagger UI renderiza essa descrição em uma interface navegável para exploração e teste \cite{swagger_ui}.

\subsection{Paginação}

APIs costumam retornar coleções de forma paginada, dividindo resultados em páginas para reduzir carga e tamanho da resposta. Para uma extração exaustiva, é necessário iterar todas as páginas até o esgotamento dos resultados \cite{drf_pagination}.

\subsection{Embeddings, busca semântica e banco vetorial}

Embedding é um vetor numérico que representa um texto de modo que conteúdos semanticamente próximos fiquem próximos no espaço vetorial. Busca semântica recupera itens por similaridade entre embeddings, e não por coincidência literal de termos.

Um banco vetorial armazena vetores e permite consultas eficientes por similaridade. Neste projeto, utilizamos o Qdrant \cite{qdrant_overview,qdrant_collections}.

\subsection{Proveniência e FAIR}

Proveniência é informação sobre origem e transformações do dado, útil para auditoria, reprodutibilidade e reuso. O modelo PROV-DM do W3C formaliza esse conceito \cite{w3c_prov_dm}. Também buscamos aderência prática aos princípios FAIR (Encontrável, Acessível, Interoperável e Reutilizável) \cite{wilkinson_fair_2016}.

% ======================================================================
\section{Metodologia}

\subsection{Visão geral do pipeline}

A Figura~\ref{fig:pipeline} resume o pipeline em seis etapas: (E1) municípios, (E2) descoberta de instâncias do SAPL, (E3) extração de PLs, (E4) transformação de ementa em ação, (E5) indexação vetorial e (E6) indicadores e agrupamento.

\begin{figure*}[t]
\centering
\resizebox{\textwidth}{!}{%
\begin{tikzpicture}[node distance=0.9cm, font=\small]
\tikzstyle{box}=[draw, rounded corners, align=center, inner sep=6pt]
\node[box] (e1) {E1\\Lista de\\municípios\\(IBGE)};
\node[box, right=0.6cm of e1] (e2) {E2\\Descoberta\\de instâncias\\do SAPL};
\node[box, right=0.6cm of e2] (e3) {E3\\Extração\\de PLs};
\node[box, right=0.6cm of e3] (e4) {E4\\Transformação\\de ementa\\em ação};
\node[box, right=0.6cm of e4] (e5) {E5\\Indexação\\vetorial\\(Qdrant)};
\node[box, right=0.6cm of e5] (e6) {E6\\Indicadores\\oficiais\\+ Agrupamento};
\draw[->] (e1) -- (e2);
\draw[->] (e2) -- (e3);
\draw[->] (e3) -- (e4);
\draw[->] (e4) -- (e5);
\draw[->] (e5) -- (e6);
\end{tikzpicture}
}%
\caption{Pipeline conceitual do Sonar Municipal.}
\label{fig:pipeline}
\end{figure*}

\subsection{Descoberta de instâncias do SAPL e extração de Projetos de Lei}
\label{sec:sapl}

\subsubsection{Universo de busca e cobertura territorial}

O quadro amostral (lista de municípios) foi obtido via API de localidades do IBGE \cite{ibge_localidades_api}. Essa escolha reduz viés de seleção por listas manuais e permite replicação a partir da mesma fonte.

\subsubsection{Geração de candidatos e validação por evidência pública}

A descoberta foi implementada como geração de candidatos + validação. A geração usa heurísticas (regras práticas baseadas em padrões observáveis de URL) para criar endereços prováveis de portais SAPL. A validação busca evidências públicas de compatibilidade (respostas e páginas de consulta) antes de aceitar a instância.

\begin{algorithm}[H]
\caption{Descoberta e validação de instâncias SAPL (visão conceitual)}
\label{alg:descoberta}
\begin{algorithmic}[1]
\Require Lista de municípios $M$ (IBGE)
\Ensure Lista de instâncias SAPL validadas $S$
\State $S \gets \emptyset$
\For{cada município $m \in M$}
  \State $C \gets$ gerar candidatos de URL para $m$ (heurísticas)
  \For{cada candidato $c \in C$}
    \If{rota pública de consulta responde e conteúdo é compatível com SAPL}
      \State adicionar $c$ em $S$
      \State break \Comment{evita duplicidade para o mesmo município}
    \EndIf
  \EndFor
\EndFor
\State \Return $S$
\end{algorithmic}
\end{algorithm}

\subsubsection{Estrutura conceitual da API do SAPL}

Quando exposta, a API tende a seguir REST \cite{fielding_rest_2000}, com endpoints de coleção (listagem) e item (detalhe). Em várias instâncias, a descrição OpenAPI e a interface Swagger UI podem estar disponíveis \cite{openapi_3_2,swagger_ui}.

\subsubsection{Extração de Projetos de Lei}

A extração foi desenhada para ser adaptável ao vocabulário local, já que rótulos variam entre casas legislativas. O método consulta o catálogo de tipos de matéria, identifica quais rótulos correspondem a ``Projeto de Lei'' e percorre todas as páginas até o esgotamento (paginação) \cite{drf_pagination}.

\begin{algorithm}[H]
\caption{Extração exaustiva de PLs via API (visão conceitual)}
\label{alg:extracao}
\begin{algorithmic}[1]
\Require Instância SAPL validada $s$
\Ensure Conjunto de PLs $P$ extraídos de $s$
\State $P \gets \emptyset$
\State $T \gets$ consultar catálogo de tipos de matéria em $s$
\State $T_{pl} \gets$ selecionar tipos que correspondem a ``Projeto de Lei''
\For{cada tipo $t \in T_{pl}$}
  \State $page \gets 1$
  \While{há resultados na página $page$}
    \State $R \gets$ requisitar lista paginada de matérias do tipo $t$ na página $page$
    \State $P \gets P \cup R$
    \State $page \gets page + 1$
  \EndWhile
\EndFor
\State \Return $P$
\end{algorithmic}
\end{algorithm}

\subsubsection{Resultado da primeira execução e customizações locais}

Na primeira execução dos coletores, foram encontradas 1.259 instâncias do SAPL. A extração automatizada de PLs foi possível em 322 instâncias, totalizando 220.065 PLs coletados. A discrepância decorre de customizações locais (mudanças de rotas, proxies, autenticação, regras anti-robô e parametrizações) que impedem ou dificultam o acesso programático.

% ======================================================================
\subsection{Construção do tradutor de ementas para ações}
\label{sec:tradutor}

Ementas têm alta variabilidade e linguagem abreviada. Usá-las diretamente em busca semântica tende a produzir resultados pouco satisfatórios: modelos de codificação não são treinados nesse estilo jurídico e as respostas retornam na mesma linguagem, dificultando a interpretação do usuário. Para reduzir ruído na busca e melhorar a interpretação do resultado, o projeto transforma ementas em recomendações de ação, preservando a semântica.

Exemplo de tradução:
\begin{table}[H]
\centering
\small
\begin{tabular}{p{0.18\linewidth} p{0.76\linewidth}}
Ementa: & \textit{CRIA O PROGRAMA DE TRANSPORTE ESCOLAR SEGURINHO PARA CRIANÇAS DA EDUCAÇÃO PÚBLICA NO MUNICÍPIO DE MARABÁ.} \\
\addlinespace[4pt]
Ação: & \textit{Criar um programa de transporte escolar para crianças da educação pública no município.} \\
\end{tabular}
\end{table}

O prompt usado na transformação explicita que a saída deve ser uma recomendação de ação operacional no formato: verbo no infinitivo + objeto + complementos essenciais. A frase precisa ser imperativa, curta e livre de juridiquês, mantendo apenas o que é necessário para executar a política.

Princípios gerais:
\begin{enumerate}[leftmargin=*]
  \item Remover casca jurídica e fórmulas padrão que não mudam a ação (por exemplo, ``dispõe sobre'', ``institui'', ``autoriza o Poder Executivo'', ``e dá outras providências'').
  \item Preservar o conteúdo material da política: o que passa a existir, ser feito, fornecido ou garantido.
  \item Converter o núcleo em verbo operacional (criar, implantar, emitir, adaptar, fornecer, atender).
  \item Escolher o nível correto entre instrumento e resultado: quando há ``programa/projeto para [ação]'', priorizar o serviço final; quando não há ação explícita, manter o instrumento.
  \item Eliminar contexto excessivo e manter apenas ação, objeto, público-alvo e local quando forem essenciais.
  \item Neutralizar nomes fantasia de programas quando não forem o objeto principal; manter nomes apenas quando o objetivo é criar um rótulo (datas, prêmios, selos ou eventos).
\end{enumerate}

No exemplo acima, a transformação elimina o nome fantasia e preserva apenas o núcleo operacional, destacando o que precisa ser executado.

Foi criado um conjunto de dados de pares \textit{ementa $\rightarrow$ ação} com 1.000 amostras sintéticas. As amostras foram obtidas apresentando ementas reais ao modelo e registrando as recomendações de ação geradas. Utilizamos o GPT-5.1-Thinking \cite{openai_gpt51_model,openai_gpt51_system_card}, com um prompt desenhado para gerar 100 amostras por vez. O objetivo é realizar transferência de aprendizado, isto é, aproveitar um modelo já treinado e ajustá-lo à tarefa com poucos exemplos. Como modelo base para o fine-tuning, utilizamos o PTT5-v2, voltado ao português \cite{piau_ptt5v2_2024}. O PTT5-v2 é uma variante do modelo T5 do Google, treinada com textos em português pela Unicamp \cite{raffel_t5_2020}.

O modelo tradutor foi treinado como tarefa seq2seq (sequência para sequência). O ajuste foi feito com QLoRA-4bit \cite{dettmers_qlora_2023}. A qualidade foi avaliada por BERTScore \cite{zhang_bertscore_2019}, obtendo 84\% na avaliação interna do projeto.

Após o treinamento, todas as ementas coletadas foram convertidas em ações, formando um conjunto finito de ações recomendáveis para indexação.

% ======================================================================
\subsection{Codificação das ações para busca semântica}
\label{sec:busca}

Com o domínio de ações definido, o passo seguinte é selecionar quais ações recomendar para cada pergunta do usuário. A escolha natural é a busca semântica, que retorna as top-$K$ ações mais compatíveis com o problema descrito.

Para indexar ações e consultas no mesmo espaço vetorial, foi utilizado o Multilingual E5 \cite{wang_e5_2024}. Esse modelo é adequado ao cenário de pergunta e resposta porque foi treinado com supervisão fraca e aprendizado contrastivo em pares de título--conteúdo e de pergunta--resposta. Como as ementas são resumos dos projetos de lei e as ações transformadas podem ser tratadas como respostas, essa configuração reduz o risco de \textit{domain shift}. Todas as ações foram codificadas com esse modelo.

As embeddings foram armazenadas no Qdrant \cite{qdrant_overview,qdrant_collections}, escolhido como banco vetorial para viabilizar uma hospedagem de baixo custo do projeto na nuvem.

Para o serviço de embeddings, uma opção prática de implantação é usar Text Embeddings Inference (TEI) \cite{hf_tei}.

% ======================================================================
\subsection{Indicadores para simulação de efeito no mundo real}
\label{sec:indicadores}

Resultados de busca semântica isoladamente podem não refletir com precisão dinâmicas sociais reais, dadas limitações de treinamento do modelo. Para aproximar o sistema do mundo real, construímos indicadores em séries temporais por município, com dados oficiais e atributos municipais comparáveis ao longo do tempo. Implementamos dois indicadores. O primeiro mede segurança pela Taxa de Homicídios por 100 mil habitantes, com base no SINESP/MJSP \cite{mjsp_homicidios}. O segundo estima evasão escolar pela Taxa de Matrículas em Ensino Regular por 100 mil habitantes, a partir dos microdados do Censo Escolar (INEP) \cite{inep_microdados_censo_escolar}.

Esses indicadores permitem estimar variações operacionais ao comparar o valor na data de apresentação do PL com o valor em meses ou anos posteriores. Como não há metodologia única para o tempo de efeito de uma ação legislativa, o sistema permite que o usuário escolha o horizonte temporal usado no cálculo.

Observação: essa estimativa é associativa, não causal. Ela descreve mudanças no período posterior, mas não prova que o PL causou a variação.

% ======================================================================
\subsection{Agrupamento de projetos em políticas públicas}
\label{sec:agrupamento}

Analisar PLs individualmente dá pouco poder estatístico e dificulta inferir benefícios com uma única amostra. Para aumentar robustez, PLs semanticamente similares são agrupados em clusters chamados ``políticas públicas''. A análise conjunta permite calcular efeito médio e dispersão e reduz a ambiguidade quando vários PLs são aplicados simultaneamente no mesmo município. Ao evidenciar ações adotadas por vários municípios e associadas a bons resultados, o agrupamento torna a análise mais confiável.

Para ranquear políticas, foi definida a métrica:

\[
Q = \frac{n_{\text{positivos}}}{n} \times \frac{n}{n+1}
\]

onde $n_{\text{positivos}}$ é o número de municípios com efeito considerado positivo (de acordo com o objetivo do indicador) e $n$ é o total de municípios no grupo. O fator $\frac{n}{n+1}$ reduz o peso de grupos muito pequenos. Um efeito positivo depende da meta do indicador: por exemplo, se o objetivo é reduzir criminalidade, uma queda no indicador é considerada um bom resultado.

% ======================================================================
\subsection{Desenvolvimento da plataforma web}
\label{sec:plataforma}

A plataforma Sonar Municipal foi desenvolvida em React com Next.js e hospedada na Vercel \cite{vercel_nextjs}. A arquitetura integra três componentes: interface web, serviço de embeddings e banco vetorial (Qdrant), conectados por APIs. O código completo do projeto (coleta, treinamento, recomendação e interface web) está disponível em \url{https://github.com/thiagoambiel/SonarMunicipal}.

Funcionalidades principais:
\begin{enumerate}[leftmargin=*]
  \item recomendação de políticas públicas com estimativa de efeito esperado baseada em dados oficiais;
  \item detalhamento de PLs (ementa, data, link do SAPL e gráfico interativo do indicador após a apresentação);
  \item busca semântica no acervo para apoiar ideação e comparação de propostas.
\end{enumerate}

Para reduzir custo de operação, o serviço de embeddings pode ser hospedado via Hugging Face, e o Qdrant armazena os vetores de ações indexadas pelo modelo E5.

% ======================================================================
\section{Resultados}

Os resultados desta etapa concentram-se na cobertura da coleta e na qualidade do tradutor de ementas.

\begin{table}[H]
\centering
\caption{Resumo da primeira execução de descoberta e extração.}
\label{tab:coleta}
\begin{tabular}{l r}
\toprule
Métrica & Valor \\
\midrule
Instâncias do SAPL encontradas & 1.259 \\
Instâncias do SAPL com extração bem-sucedida & 322 \\
Projetos de Lei coletados (total) & 220.065 \\
\bottomrule
\end{tabular}
\end{table}

Como mostra a Tabela~\ref{tab:coleta}, a primeira execução dos coletores atingiu escala nacional, com extração bem-sucedida em parte das instâncias descobertas. Na avaliação interna, o tradutor ementa $\rightarrow$ ação atingiu BERTScore de 84\%, indicando preservação semântica adequada para uso prático.

% ======================================================================
\section{Limitações e ameaças à validade}

Este estudo enfrenta limitações operacionais e metodológicas. Do ponto de vista operacional, a disponibilidade das instâncias do SAPL é variável: há instabilidades, mudanças de URL e barreiras como proxies, autenticação e regras anti-robô, o que reduz a cobertura efetiva da coleta. Além disso, customizações locais e diferenças de configuração afetam a padronização dos endpoints e dificultam a extração automática. No aspecto semântico, a variação de rótulos e tipos de proposição entre casas legislativas pode levar a omissões ou inconsistências na identificação de Projetos de Lei. Já na análise de impacto, a variação de indicadores ao longo do tempo não pode ser atribuída de forma causal a um único PL, pois outras políticas e fatores contextuais podem influenciar os resultados. Por fim, o uso de um conjunto de dados sintético para treinar o tradutor pode introduzir vieses do gerador e limitar a generalização do modelo em cenários reais.

% ======================================================================
\section{Conclusão}

O Sonar Municipal integra coleta sistemática de PLs via SAPL, transformação de ementas em ações, busca semântica por embeddings, análise com indicadores e agrupamento de políticas públicas. O projeto entrega uma ferramenta que aproxima evidências legislativas e dados oficiais do fluxo de trabalho de gestores públicos, com foco em reprodutibilidade e auditabilidade. Como resultado, a plataforma favorece a comparação entre propostas, a identificação de alternativas e a tomada de decisão informada, mantendo transparência sobre a origem e o processamento dos dados.

% ======================================================================
\printbibliography

\end{document}
